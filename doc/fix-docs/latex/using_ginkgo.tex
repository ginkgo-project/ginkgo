\subsubsection*{Prerequisites}

\paragraph*{Linux and Mac OS}

For Ginkgo core library\+:


\begin{DoxyItemize}
\item \+\_\+cmake 3.\+9+\+\_\+
\item C++11 compliant compiler, one of\+:
\begin{DoxyItemize}
\item \+\_\+gcc 5.\+3+, 6.\+3+, 7.\+3+, 8.\+1+\+\_\+
\item \+\_\+clang 3.\+9+\+\_\+
\item \+\_\+\+Apple L\+L\+VM 8.\+0+\+\_\+ ({\bfseries T\+O\+DO}\+: verify)
\end{DoxyItemize}
\end{DoxyItemize}

The Ginkgo C\+U\+DA module has the following {\bfseries additional} requirements\+:


\begin{DoxyItemize}
\item \+\_\+\+C\+U\+DA 9.\+0+\+\_\+
\item Any host compiler restrictions your version of C\+U\+DA may impose also apply here. For the newest C\+U\+DA version, this information can be found in the \href{https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html}{\tt C\+U\+DA installation guide for Linux} or \href{https://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html}{\tt C\+U\+DA installation guide for Mac Os X}
\end{DoxyItemize}

In addition, if you want to contribute code to Ginkgo, you will also need the following\+:


\begin{DoxyItemize}
\item {\itshape clang-\/format 5.\+0.\+1+\+\_\+ (ships as part of \+\_\+clang})
\end{DoxyItemize}

\paragraph*{Windows}

Windows is currently not supported, but we are working on porting the library there. If you are interested in helping us with this effort, feel free to contact one of the developers. (The library itself doesn\textquotesingle{}t use any non-\/standard C++ features, so most of the effort here is in modifying the build system.)

{\bfseries T\+O\+DO\+:} Some restrictions will also apply on the version of C and C++ standard libraries installed on the system. We need to investigate this further.

\subsection*{Building Ginkgo }

Use the standard cmake build procedure\+:


\begin{DoxyCode}
mkdir build; cd build
cmake -G "Unix Makefiles" [OPTIONS] .. && make
\end{DoxyCode}


Replace {\ttfamily \mbox{[}O\+P\+T\+I\+O\+NS\mbox{]}} with desired cmake options for your build. Ginkgo adds the following additional switches to control what is being built\+:


\begin{DoxyItemize}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+D\+E\+V\+E\+L\+\_\+\+T\+O\+O\+LS=\{ON, O\+FF\}} sets up the build system for development (requires clang-\/format, will also download git-\/cmake-\/format), default is {\ttfamily ON}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+E\+S\+TS=\{ON, O\+FF\}} builds Ginkgo\textquotesingle{}s tests (will download googletest), default is {\ttfamily ON}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+B\+E\+N\+C\+H\+M\+A\+R\+KS=\{ON, O\+FF\}} builds Ginkgo\textquotesingle{}s benchmarks (will download gflags and rapidjson), default is {\ttfamily ON}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+E\+X\+A\+M\+P\+L\+ES=\{ON, O\+FF\}} builds Ginkgo\textquotesingle{}s examples, default is {\ttfamily ON}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+R\+E\+F\+E\+R\+E\+N\+CE=\{ON, O\+FF\}} build reference implementations of the kernels, useful for testing, default is {\ttfamily O\+FF}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+O\+MP=\{ON, O\+FF\}} builds optimized Open\+MP versions of the kernels, default is {\ttfamily O\+FF}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+C\+U\+DA=\{ON, O\+FF\}} builds optimized cuda versions of the kernels (requires C\+U\+DA), default is {\ttfamily O\+FF}
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+D\+OC=\{ON, O\+FF\}} creates an H\+T\+ML version of Ginkgo\textquotesingle{}s documentation from inline comments in the code. The default is {\ttfamily O\+FF}.
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+D\+O\+C\+\_\+\+G\+E\+N\+E\+R\+A\+T\+E\+\_\+\+P\+DF=\{ON, O\+FF\}} generates a P\+DF version of Ginkgo\textquotesingle{}s documentation from inline comments in the code. The default is {\ttfamily O\+FF}.
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+D\+O\+C\+\_\+\+G\+E\+N\+E\+R\+A\+T\+E\+\_\+\+D\+EV=\{ON, O\+FF\}} generates the developer version of Ginkgo\textquotesingle{}s documentation. The default is {\ttfamily O\+FF}.
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+E\+X\+P\+O\+R\+T\+\_\+\+B\+U\+I\+L\+D\+\_\+\+D\+IR=\{ON, O\+FF\}} adds the Ginkgo build directory to the C\+Make package registry. The default is {\ttfamily O\+FF}.
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+V\+E\+R\+B\+O\+S\+E\+\_\+\+L\+E\+V\+EL=integer} sets the verbosity of Ginkgo.
\begin{DoxyItemize}
\item {\ttfamily 0} disables all output in the main libraries,
\item {\ttfamily 1} enables a few important messages related to unexpected behavior (default).
\end{DoxyItemize}
\item {\ttfamily -\/\+D\+C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX=path} sets the installation path for {\ttfamily make install}. The default value is usually something like {\ttfamily /usr/local}
\item {\ttfamily -\/\+D\+C\+M\+A\+K\+E\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE=type} specifies which configuration will be used for this build of Ginkgo. The default is {\ttfamily R\+E\+L\+E\+A\+SE}. Supported values are C\+Make\textquotesingle{}s standard build types such as {\ttfamily D\+E\+B\+UG} and {\ttfamily R\+E\+L\+E\+A\+SE} and the Ginkgo specific {\ttfamily C\+O\+V\+E\+R\+A\+GE}, {\ttfamily A\+S\+AN} (Address\+Sanitizer) and {\ttfamily T\+S\+AN} (Thread\+Sanitizer) types.
\item {\ttfamily -\/\+D\+B\+U\+I\+L\+D\+\_\+\+S\+H\+A\+R\+E\+D\+\_\+\+L\+I\+BS=\{ON, O\+FF\}} builds ginkgo as shared libraries ({\ttfamily O\+FF}) or as dynamic libraries ({\ttfamily ON}), default is {\ttfamily ON}
\item {\ttfamily -\/\+D\+C\+M\+A\+K\+E\+\_\+\+C\+U\+D\+A\+\_\+\+H\+O\+S\+T\+\_\+\+C\+O\+M\+P\+I\+L\+ER=path} instructs the build system to explicitly set C\+U\+DA\textquotesingle{}s host compiler to the path given as argument. By default, C\+U\+DA uses its toolchain\textquotesingle{}s host compiler. Setting this option may help if you\textquotesingle{}re experiencing linking errors due to A\+BI incompatibilities. This option is supported since \href{https://github.com/Kitware/CMake/commit/489c52ce680df6439f9c1e553cd2925ca8944cb1}{\tt C\+Make 3.\+8} but \href{https://cmake.org/cmake/help/v3.10/variable/CMAKE_CUDA_HOST_COMPILER.html}{\tt documented starting from 3.\+10}.
\item {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+C\+U\+D\+A\+\_\+\+A\+R\+C\+H\+I\+T\+E\+C\+T\+U\+R\+ES=$<$list$>$} where {\ttfamily $<$list$>$} is a semicolon ({\ttfamily ;}) separated list of architectures. Supported values are\+:
\begin{DoxyItemize}
\item {\ttfamily Auto}
\item {\ttfamily Kepler}, {\ttfamily Maxwell}, {\ttfamily Pascal}, {\ttfamily Volta}
\item {\ttfamily C\+O\+DE}, {\ttfamily C\+O\+D\+E(\+C\+O\+M\+P\+U\+T\+E)}, {\ttfamily (C\+O\+M\+P\+U\+TE)}
\end{DoxyItemize}

{\ttfamily Auto} will automatically detect the present C\+U\+D\+A-\/enabled G\+PU architectures in the system. {\ttfamily Kepler}, {\ttfamily Maxwell}, {\ttfamily Pascal} and {\ttfamily Volta} will add flags for all architectures of that particular N\+V\+I\+D\+IA G\+PU generation. {\ttfamily C\+O\+M\+P\+U\+TE} and {\ttfamily C\+O\+DE} are placeholders that should be replaced with compute and code numbers (e.\+g. for {\ttfamily compute\+\_\+70} and {\ttfamily sm\+\_\+70} {\ttfamily C\+O\+M\+P\+U\+TE} and {\ttfamily C\+O\+DE} should be replaced with {\ttfamily 70}. Default is {\ttfamily Auto}. For a more detailed explanation of this option see the \href{https://github.com/ginkgo-project/CudaArchitectureSelector/blob/master/CudaArchitectureSelector.cmake#L58}{\tt {\ttfamily A\+R\+C\+H\+I\+T\+E\+C\+T\+U\+R\+ES} specification list} section in the documentation of the Cuda\+Architecture\+Selector C\+Make module.
\end{DoxyItemize}

For example, to build everything (in debug mode), use\+:


\begin{DoxyCode}
cmake  -G "Unix Makefiles" -H. -BDebug -DCMAKE\_BUILD\_TYPE=Debug -DGINKGO\_DEVEL\_TOOLS=ON \(\backslash\)
      -DGINKGO\_BUILD\_TESTS=ON -DGINKGO\_BUILD\_REFERENCE=ON -DGINKGO\_BUILD\_OMP=ON \(\backslash\)
      -DGINKGO\_BUILD\_CUDA=ON 
cmake --build Debug
\end{DoxyCode}


N\+O\+TE\+: Ginkgo is known to work with the {\ttfamily Unix Makefiles} and {\ttfamily Ninja} based generators. Other C\+Make generators are untested.

\subsubsection*{Third party libraries and packages}

Ginkgo relies on third party packages in different cases. These third party packages can be turned off by disabling the relevant options.


\begin{DoxyItemize}
\item G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+C\+U\+DA=ON\+: \href{https://github.com/ginkgo-project/CudaArchitectureSelector}{\tt Cuda\+Architecture\+Selector} (C\+AS) is a C\+Make helper to manage C\+U\+DA architecture settings;
\item G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+E\+S\+TS=ON\+: Our tests are implemented with \href{https://github.com/google/googletest}{\tt Google Test};
\item G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+B\+E\+N\+C\+H\+M\+A\+R\+KS=ON\+: For argument management we use \href{https://github.com/gflags/gflags}{\tt gflags} and for J\+S\+ON parsing we use \href{https://github.com/Tencent/rapidjson}{\tt Rapid\+J\+S\+ON};
\item G\+I\+N\+K\+G\+O\+\_\+\+D\+E\+V\+E\+L\+\_\+\+T\+O\+O\+LS=ON\+: \href{https://github.com/gflegar/git-cmake-format}{\tt git-\/cmake-\/format} is our C\+Make helper for code formatting.
\end{DoxyItemize}

By default, Ginkgo uses the internal version of each package. For each of the packages {\ttfamily G\+T\+E\+ST}, {\ttfamily G\+F\+L\+A\+GS} and {\ttfamily R\+A\+P\+I\+D\+J\+S\+ON} and {\ttfamily C\+AS}, it is possible to force Ginkgo to try to use an external version of a package. For this, set the C\+Make option {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+U\+S\+E\+\_\+\+E\+X\+T\+E\+R\+N\+A\+L\+\_\+$<$package$>$=ON}.\#\#\# Installing Ginkgo

\subsubsection*{Installation}

To install Ginkgo into the specified folder, execute the following command in the build folder


\begin{DoxyCode}
make install
\end{DoxyCode}


If the installation prefix (see {\ttfamily C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX}) is not writable for your user, e.\+g. when installing Ginkgo system-\/wide, it might be necessary to prefix the call with {\ttfamily sudo}.

After the installation, C\+Make can find ginkgo with {\ttfamily find\+\_\+package(\+Ginkgo)}. An example can be found in the \href{test_install/CMakeLists.txt}{\tt {\ttfamily test\+\_\+install}}.

\subsubsection*{Running the unit tests}

You need to compile ginkgo with {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+E\+S\+TS=ON} option to be able to run the tests.

\paragraph*{Using make test}

After configuring Ginkgo, use the following command inside the build folder to run all tests\+:


\begin{DoxyCode}
make test
\end{DoxyCode}


The output should contain several lines of the form\+:


\begin{DoxyCode}
    Start  1: path/to/test
1/13 Test  #1: path/to/test .............................   Passed    0.01 sec
\end{DoxyCode}


To run only a specific test and see more details results (e.\+g. if a test failed) run the following from the build folder\+:


\begin{DoxyCode}
./path/to/test
\end{DoxyCode}


where {\ttfamily path/to/test} is the path returned by {\ttfamily make test}.

\paragraph*{Using C\+Test}

The tests can also be ran through C\+Test from the command line, for example when in a configured build directory\+:


\begin{DoxyCode}
ctest -T start -T build -T test -T submit
\end{DoxyCode}


Will start a new test campaign (usually in {\ttfamily Experimental} mode), build Ginkgo with the set configuration, run the tests and submit the results to our C\+Dash dashboard.

Another option is to use Ginkgo\textquotesingle{}s C\+Test script which is configured to build Ginkgo with default settings, runs the tests and submits the test to our C\+Dash dashboard automatically.

To run the script, use the following command\+:


\begin{DoxyCode}
ctest -S cmake/CTestScript.cmake
\end{DoxyCode}


The default settings are for our own CI system. Feel free to configure the script before launching it through variables or by directly changing its values. A documentation can be found in the script itself.

\subsubsection*{Running the benchmarks}

In addition to the unit tests designed to verify correctness, Ginkgo also includes a benchmark suite for checking its performance on the system. To compile the benchmarks, the flag {\ttfamily -\/\+D\+G\+I\+N\+K\+G\+O\+\_\+\+B\+U\+I\+L\+D\+\_\+\+B\+E\+N\+C\+H\+M\+A\+R\+KS=ON} has to be set during the {\ttfamily cmake} step. In addition, the \href{https://github.com/ginkgo-project/ssget}{\tt {\ttfamily ssget} command-\/line utility} has to be installed on the system.

The benchmark suite tests Ginkgo\textquotesingle{}s performance using the \href{https://sparse.tamu.edu/}{\tt Suite\+Sparse matrix collection} and artificially generated matrices. The suite sparse collection will be downloaded automatically when the benchmarks are run. Please note that the entire collection requires roughly 100\+GB of disk storage in its compressed format, and roughly 25\+GB of additional disk space for intermediate data (such us uncompressing the archive). Additionally, the benchmark runs usually take a long time (Sp\+MV benchmarks on the complete collection take roughly 24h using the K20 G\+PU), and will stress the system.

The benchmark suite is invoked using the {\ttfamily make benchmark} command in the build directory. The behavior of the suite can be modified using environment variables. Assuming the {\ttfamily bash} shell is used, these can either be specified via the {\ttfamily export} command to persist between multiple runs\+:


\begin{DoxyCode}
export VARIABLE="value"
...
make benchmark
\end{DoxyCode}


or specified on the fly, on the same line as the {\ttfamily make benchmark} command\+:


\begin{DoxyCode}
env VARIABLE="value" ... make benchmark
\end{DoxyCode}


Since {\ttfamily make} sets any variables passed to it as temporary environment variables, the following shorthand can also be used\+:


\begin{DoxyCode}
make benchmark VARIABLE="value" ...
\end{DoxyCode}


A combination of the above approaches is also possible (e.\+g. it may be useful to {\ttfamily export} the {\ttfamily S\+Y\+S\+T\+E\+M\+\_\+\+N\+A\+ME} variable, and specify the others at every benchmark run).

Supported environment variables are described in the following list\+:


\begin{DoxyItemize}
\item {\ttfamily B\+E\+N\+C\+H\+M\+A\+RK=\{spmv, solver, preconditioner\}} -\/ The benchmark set to run. Default is {\ttfamily spmv}.
\begin{DoxyItemize}
\item {\ttfamily spmv} -\/ Runs the sparse matrix-\/vector product benchmarks on the Suite\+Sparse collection.
\item {\ttfamily solver} -\/ Runs the solver benchmarks on the Suite\+Sparse collection. The matrix format is determined by running the {\ttfamily spmv} benchmarks first, and using the fastest format determined by that benchmark. The maximum number of iterations for the iterative solvers is set to 10,000 and the requested residual reduction factor to 1e-\/6.
\item {\ttfamily preconditioner} -\/ Runs the preconditioner benchmarks on artificially generated block-\/diagonal matrices.
\end{DoxyItemize}
\item {\ttfamily D\+R\+Y\+\_\+\+R\+UN=\{true, false\}} -\/ If set to {\ttfamily true}, prepares the system for the benchmark runs (downloads the collections, creates the result structure, etc.) and outputs the list of commands that would normally be run, but does not run the benchmarks themselves. Default is {\ttfamily false}.
\item {\ttfamily E\+X\+E\+C\+U\+T\+OR=\{reference,cuda,omp\}} -\/ The executor used for running the benchmarks. Default is {\ttfamily cuda}.
\item {\ttfamily S\+E\+G\+M\+E\+N\+TS=$<$N$>$} -\/ Splits the benchmark suite into {\ttfamily $<$N$>$} segments. This option is useful for running the benchmarks on an H\+PC system with a batch scheduler, as it enables partitioning of the benchmark suite and running it concurrently on multiple nodes of the system. If specified, {\ttfamily S\+E\+G\+M\+E\+N\+T\+\_\+\+ID} also has to be set. Default is {\ttfamily 1}.
\item {\ttfamily S\+E\+G\+M\+E\+N\+T\+\_\+\+ID=$<$I$>$} -\/ used in combination with the {\ttfamily S\+E\+G\+M\+E\+N\+TS} variable. {\ttfamily $<$I$>$} should be an integer between 1 and {\ttfamily $<$N$>$}. If specified, only the {\ttfamily $<$I$>$}-\/th segment of the benchmark suite will be run. Default is {\ttfamily 1}.
\item {\ttfamily S\+Y\+S\+T\+E\+M\+\_\+\+N\+A\+ME=$<$name$>$} -\/ the name of the system where the benchmarks are being run. This option only changes the directory where the benchmark results are stored. It can be used to avoid overwriting the benchmarks if multiple systems share the same filesystem, or when copying the results between systems. Default is {\ttfamily unknown}.
\end{DoxyItemize}

Once {\ttfamily make benchmark} completes, the results can be found in {\ttfamily $<$Ginkgo build directory$>$/benchmark/results//}. The files are written in the J\+S\+ON format, and can be analyzed using any of the data analysis tools that support J\+S\+ON. Alternatively, they can be uploaded to an online repository, and analyzed using Ginkgo\textquotesingle{}s free web tool \href{https://ginkgo-project.github.io/gpe/}{\tt Ginkgo Performance Explorer (G\+PE)}. (Make sure to change the \char`\"{}\+Performance data U\+R\+L\char`\"{} to your repository if using G\+PE.) 